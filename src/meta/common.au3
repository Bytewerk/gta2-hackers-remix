; Variables derivated from defines in common.h
Global Const $GTA2_PLAYER_COUNT = 6


; Global variables
Global $global_sock


; This gets generated by SDL2 in the menu and has a trailing slash.
; The menu sends this as soon, as the meta component connects.
Global $global_config_path = NULL

Global $global_game_instances_open = 0
Global $global_game_process_ids[$GTA2_PLAYER_COUNT]
Global $global_game_screen_layouts[$GTA2_PLAYER_COUNT]

; Initialize Arrayss
For $i=0 To $GTA2_PLAYER_COUNT-1
	$global_game_process_ids[$i] = 0
Next

; Zero-terminated string reply to the server
Func re($message)
	TCPSend($global_sock, $message & Chr(0))
Endfunc


Func send_pid_table()
	Local $str = "PID_TABLE"
	For $i=0 To $GTA2_PLAYER_COUNT - 1
		$str &= " " & $global_game_process_ids[$i]
	Next
	re($str)
Endfunc


; "clean room" re-implementation of _GetHwndFromPID($PID)
;
; A similar function can be found in the autoit forums - but with an
; unknown author and license. This is my own version, created without
; looking at the source code found there:
;
; https://www.autoitscript.com/forum/topic/
; 86680-pid-window-handle-hwnd-conversion/?do=findComment&comment=621521

Func get_hwnd_from_pid($pid)
	Local $list = WinList()
	For $i = 1 To $list[0][0] -1
	
		Local $hwnd = $list[$i][1]
		
		If WinGetProcess($hwnd) == $pid Then _
			Return $hwnd
	Next
	Return Null
Endfunc


Func wait_for_hwnd_by_pid($pid)
	While True
		Local $hwnd = get_hwnd_from_pid($pid)
		If $hwnd Then _
			Return $hwnd
		Sleep(100)
	Wend
Endfunc








